<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Magic Piano</title>
    <link href="https://fonts.googleapis.com/css2?family=Nunito:wght@400;600;700;800&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <div class="app-container">
        <header>
            <h1>Magic Piano</h1>
            <p class="subtitle">Press keys to hint - AI picks the best notes</p>
        </header>

        <main>
            <!-- Current Note Display -->
            <div class="note-display" id="note-display"></div>

            <!-- On-screen Piano - Two Octaves -->
            <section class="piano-section">
                <!-- Upper Octave (C4-B4) -->
                <div class="piano-container">
                    <div class="octave-label">Octave 4</div>
                    <div class="piano-keys">
                        <div class="piano-key white" data-midi="60"><span>C</span><small>Q</small></div>
                        <div class="piano-key white" data-midi="62"><span>D</span><small>W</small></div>
                        <div class="piano-key white" data-midi="64"><span>E</span><small>E</small></div>
                        <div class="piano-key white" data-midi="65"><span>F</span><small>R</small></div>
                        <div class="piano-key white" data-midi="67"><span>G</span><small>T</small></div>
                        <div class="piano-key white" data-midi="69"><span>A</span><small>Y</small></div>
                        <div class="piano-key white" data-midi="71"><span>B</span><small>U</small></div>
                        <div class="piano-key black" data-midi="61" style="left: calc(14.28% - 12px);"><span>C#</span><small>2</small></div>
                        <div class="piano-key black" data-midi="63" style="left: calc(28.57% - 12px);"><span>D#</span><small>3</small></div>
                        <div class="piano-key black" data-midi="66" style="left: calc(57.14% - 12px);"><span>F#</span><small>5</small></div>
                        <div class="piano-key black" data-midi="68" style="left: calc(71.43% - 12px);"><span>G#</span><small>6</small></div>
                        <div class="piano-key black" data-midi="70" style="left: calc(85.71% - 12px);"><span>A#</span><small>7</small></div>
                    </div>
                </div>

                <!-- Lower Octave (C3-B3) -->
                <div class="piano-container">
                    <div class="octave-label">Octave 3</div>
                    <div class="piano-keys">
                        <div class="piano-key white" data-midi="48"><span>C</span><small>Z</small></div>
                        <div class="piano-key white" data-midi="50"><span>D</span><small>X</small></div>
                        <div class="piano-key white" data-midi="52"><span>E</span><small>C</small></div>
                        <div class="piano-key white" data-midi="53"><span>F</span><small>V</small></div>
                        <div class="piano-key white" data-midi="55"><span>G</span><small>B</small></div>
                        <div class="piano-key white" data-midi="57"><span>A</span><small>N</small></div>
                        <div class="piano-key white" data-midi="59"><span>B</span><small>M</small></div>
                        <div class="piano-key black" data-midi="49" style="left: calc(14.28% - 12px);"><span>C#</span><small>S</small></div>
                        <div class="piano-key black" data-midi="51" style="left: calc(28.57% - 12px);"><span>D#</span><small>D</small></div>
                        <div class="piano-key black" data-midi="54" style="left: calc(57.14% - 12px);"><span>F#</span><small>G</small></div>
                        <div class="piano-key black" data-midi="56" style="left: calc(71.43% - 12px);"><span>G#</span><small>H</small></div>
                        <div class="piano-key black" data-midi="58" style="left: calc(85.71% - 12px);"><span>A#</span><small>J</small></div>
                    </div>
                </div>
            </section>

            <!-- Note history -->
            <section class="history-section">
                <div class="note-history" id="note-history"></div>
            </section>

            <!-- Controls -->
            <section class="control-section">
                <div class="control-row">
                    <label>Creativity</label>
                    <input type="range" id="temperature" min="0.5" max="2" step="0.1" value="1.2">
                    <span id="temp-value">1.2</span>
                </div>
                <button id="reset-btn" class="reset-btn">Reset</button>
            </section>

            <div class="status" id="status">Loading...</div>

            <!-- Technical Description -->
            <section class="tech-section">
                <h3>How It Works</h3>
                <div class="tech-content">
                    <div class="tech-block">
                        <h4>MelodyRNN</h4>
                        <p>This app uses <strong>MelodyRNN</strong>, a recurrent neural network trained by Google Magenta on thousands of MIDI melodies. The model learns musical patterns like scales, intervals, and melodic contours, predicting which notes are likely to follow a given sequence.</p>
                    </div>
                    <div class="tech-block">
                        <h4>Human Hinting</h4>
                        <p>When you press a key, you provide a <strong>hint</strong> to the AI. Instead of forcing that exact note, we apply a <strong>soft Gaussian bias</strong> to the RNN's probability distribution. Notes closer to your hint get boosted, while distant notes are suppressed&mdash;but the AI still picks from all possibilities weighted by musical sensibility.</p>
                    </div>
                    <div class="tech-block">
                        <h4>The Math</h4>
                        <p>For each candidate note, we compute: <code>weight = e^(-d²/2σ²)</code> where <em>d</em> is the semitone distance from your hint and <em>σ</em> controls the spread. The final probability is <code>P(note) × weight</code>, then we sample from this biased distribution. This creates an "auto-tune" effect where you guide the melody while the AI ensures it sounds musical.</p>
                    </div>
                </div>
            </section>
        </main>
    </div>

    <!-- Start Overlay -->
    <div id="init-overlay" class="overlay">
        <div class="overlay-content">
            <h2>Magic Piano</h2>
            <p>AI-powered melody generation</p>
            <div class="loading" id="loading">
                <div class="spinner"></div>
                <p>Loading neural network...</p>
            </div>
            <button id="start-btn" class="start-btn" style="display:none;">Start Playing</button>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/@magenta/music@1.23.1/dist/magentamusic.min.js"></script>
    <script src="app.js"></script>
</body>
</html>
