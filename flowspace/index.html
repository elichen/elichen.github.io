<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FlowSpace - Interactive Fluid Simulation</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <canvas id="flowCanvas"></canvas>
    <div class="controls">
        <div class="control-group">
            <label for="viscosity">Viscosity</label>
            <input type="range" id="viscosity" min="0" max="100" value="50">
        </div>
        <div class="control-group">
            <label for="flowStrength">Flow Strength</label>
            <input type="range" id="flowStrength" min="0" max="100" value="75">
        </div>
        <div class="control-group">
            <label for="colorMode">Color Mode</label>
            <select id="colorMode">
                <option value="rainbow">Rainbow</option>
                <option value="ocean">Ocean</option>
                <option value="fire">Fire</option>
            </select>
        </div>
    </div>
    
    <!-- Shader Scripts -->
    <script type="x-shader/x-vertex" id="vertexShader">
        attribute vec2 position;
        varying vec2 uv;

        void main() {
            uv = position * 0.5 + 0.5;
            gl_Position = vec4(position, 0.0, 1.0);
        }
    </script>

    <script type="x-shader/x-fragment" id="fragmentShader">
        precision highp float;

        uniform sampler2D uVelocity;
        uniform sampler2D uPressure;
        uniform vec2 uMouse;
        uniform vec2 uResolution;
        uniform float uViscosity;
        uniform float uFlowStrength;
        uniform int uColorMode;
        uniform float uTime;

        varying vec2 uv;

        // Noise functions
        float rand(vec2 n) { 
            return fract(sin(dot(n, vec2(12.9898, 4.1414))) * 43758.5453);
        }

        float noise(vec2 p) {
            vec2 ip = floor(p);
            vec2 u = fract(p);
            u = u * u * (3.0 - 2.0 * u);
            
            float res = mix(
                mix(rand(ip), rand(ip + vec2(1.0, 0.0)), u.x),
                mix(rand(ip + vec2(0.0, 1.0)), rand(ip + vec2(1.0, 1.0)), u.x), u.y);
            return res * res;
        }

        vec2 getBackgroundFlow(vec2 pos) {
            float scale = 3.0;
            float timeScale = 0.2;
            vec2 flow = vec2(
                noise(pos * scale + vec2(uTime * timeScale, 0.0)),
                noise(pos * scale + vec2(0.0, uTime * timeScale))
            );
            return (flow - 0.5) * 2.0;
        }

        vec3 getRainbowColor(float t) {
            vec3 c = 0.5 + 0.5 * cos(6.28318 * (t + vec3(0.0, 0.33, 0.67)));
            return mix(vec3(0.2), c, 0.8);
        }

        vec3 getOceanColor(float t) {
            return mix(vec3(0.0, 0.1, 0.2), vec3(0.0, 0.5, 1.0), t);
        }

        vec3 getFireColor(float t) {
            return mix(vec3(1.0, 0.0, 0.0), vec3(1.0, 0.7, 0.0), t);
        }

        void main() {
            vec2 texel = 1.0 / uResolution;
            vec2 coord = gl_FragCoord.xy / uResolution;
            
            // Sample velocity and pressure
            vec2 v = texture2D(uVelocity, coord).xy;
            float p = texture2D(uPressure, coord).x;
            
            // Background flow
            vec2 bgFlow = getBackgroundFlow(coord) * 0.3;
            
            // Mouse influence
            vec2 mouseVel = (uMouse - coord) * uFlowStrength;
            float mouseDist = length(mouseVel);
            mouseVel = mouseVel * smoothstep(0.5, 0.0, mouseDist);
            
            // Combine flows
            v = v + mouseVel + bgFlow;
            v = v * (1.0 - uViscosity * 0.01);
            
            // Calculate curl for visualization
            float curl = length(v);
            
            // Add time-based variation to curl
            curl = curl + noise(coord * 5.0 + uTime * 0.1) * 0.2;
            
            // Color based on mode
            vec3 color;
            if (uColorMode == 0) {
                color = getRainbowColor(curl);
            } else if (uColorMode == 1) {
                color = getOceanColor(curl);
            } else {
                color = getFireColor(curl);
            }
            
            gl_FragColor = vec4(color, 1.0);
        }
    </script>

    <script src="app.js"></script>
</body>
</html> 