<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Snake AI - Egocentric PPO</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <div class="container">
        <h1>Snake AI</h1>
        <p class="subtitle">Egocentric observation with symmetric augmentation</p>

        <div class="canvas-wrapper">
            <canvas id="gameCanvas" width="600" height="600"></canvas>
            <div id="loadingOverlay" class="loading-overlay">
                <div class="loading-spinner"></div>
                <div class="loading-text">Loading AI model...</div>
                <div class="loading-subtext">This may take a few seconds (164 MB)</div>
            </div>
        </div>

        <div class="stats">
            <div class="stat-item">
                <span class="stat-value" id="score">0</span>
                <span class="stat-label">Current Score</span>
            </div>
            <div class="stat-item">
                <span class="stat-value" id="episode">1</span>
                <span class="stat-label">Episode</span>
            </div>
            <div class="stat-item">
                <span class="stat-value" id="foodEaten">0</span>
                <span class="stat-label">Food Eaten</span>
            </div>
        </div>

        <p id="modelStatus"></p>

        <div class="description">
            <p>This agent uses <strong>egocentric observation</strong>: the grid is rotated so the snake always "faces up", reducing complexity. Combined with <strong>symmetric augmentation</strong> (horizontal flips during training), this achieves strong performance on 20x20 Snake.</p>
        </div>

        <div class="metrics">
            <div class="metric-card">
                <div class="label">Training Steps</div>
                <div class="value">~50M</div>
            </div>
            <div class="metric-card">
                <div class="label">Best Score</div>
                <div class="value">254/397</div>
            </div>
            <div class="metric-card">
                <div class="label">Observation</div>
                <div class="value">5x22x22</div>
            </div>
            <div class="metric-card">
                <div class="label">Parameters</div>
                <div class="value">4.4M</div>
            </div>
        </div>

        <div class="technical-details">
            <h3>5-Channel Egocentric Observations</h3>
            <p>The agent sees a 22x22 grid (20x20 + wall padding) rotated so it always faces "up":</p>
            <ul>
                <li><strong>Channel 0 - Head:</strong> 1 at head position</li>
                <li><strong>Channel 1 - Body:</strong> 1 at all snake segments</li>
                <li><strong>Channel 2 - Food:</strong> 1 at food position</li>
                <li><strong>Channel 3 - Length:</strong> Normalized snake length (snake_len / 400)</li>
                <li><strong>Channel 4 - Walls:</strong> 1 at border cells</li>
            </ul>
            <p>By rotating the grid based on the snake's direction, the agent learns direction-invariant patterns.</p>

            <h3>Network Architecture (2x Scale)</h3>
            <ul>
                <li><strong>Algorithm:</strong> PPO (Proximal Policy Optimization)</li>
                <li><strong>Input:</strong> 5 x 22 x 22 = 2,420 features (flattened)</li>
                <li><strong>Backbone:</strong> FC 2048 + FC 1024 + FC 512 + FC 256 (with LayerNorm)</li>
                <li><strong>Policy Head:</strong> FC 128 + FC 3 (left/straight/right)</li>
                <li><strong>Total Parameters:</strong> 4.4 million</li>
                <li><strong>Training:</strong> 256 parallel environments on Apple Silicon (MPS)</li>
            </ul>
        </div>
    </div>

    <script src="snake.js"></script>
    <script src="web_model_egocentric/agent-egocentric.js"></script>
    <script src="web_model_egocentric/script-egocentric.js"></script>
</body>
</html>
